8장. 단위 테스트
----------------

### 테스트를 좋아하는가?

> '코드를 작성하는 것은 좋아하지만, 테스트는 귀찮아서 하기 싫타' 라고 생각하는 프로그래머들이 많다. 하지만, 테스트를 멀리 하면 버그는 없어지지 않으며, 버그가 많은 코드는 절대 좋은 코드라 말할 수 없다. 만약 테스트하는 것을 코딩하는 것과 같은 마음으로 행한다면, 테스트의 귀찮음은 경감되고 버그도 줄게 될 것이다.

### 단위 테스트란 무엇인가?

> 단위 테스트는 유닛 테스트라고도 불리며, 메소드나 클래스 등의 구현 코드에 대하여 작성되는 테스트를 말한다.

### 단위 테스트의 효능

###### - 다양한 테스트를 자동화할 수 있다.

> 단위 테스트를 사용하면, 입력값이나 기댓값을 조금씩 변경하면서 다양한 테스트를 자동 실행할 수 있다.

###### - 회귀 테스트에 의해 코드가 망가지지 않은 것을 보증할 수 있다.

> 자동화된 단위 테스트는 배치 처리나 Jenkins 등의 계속적인 CI 툴을 사용함으로써 정기적으로 실행할 수 있다. 특히 계속적인 CI 툴을 사용하면, 코드의 커밋과 동시에 모든 단위 테스트가 실행되어 커밋에 의한 코드가 손상되지 않았는가를 자동적으로 발견해 준다. 장기간에 걸쳐 개발과 릴리즈를 반복하는 프로젝트에는 단위 테스트가 더할 나위 없는 안전장치로서의 역할을 하고 있는 것이다.

###### - 설계의 개선으로 이어진다.

> 단위 테스트를 작성할 경우, '테스트 대상의 코드가 목적의 장소에서 사용되는 것' 뿐만 아니라 적어도 '테스트 코드로부터 실행할 수 있도록' 설계가 되어 있어야 한다. 이것은 특별히 재이용 가능한 컴포넌트나 라이브러리의 개발에 있어서 좋은 설계로의 개선을 재촉해 준다.

### 단위 테스트의 지침

###### - 테스트 정책을 정해 두자.

> 컨트롤러 층, 서비스층, 데이터 액세스 층에 대해서 테스트를 작성하는 접근 방식도 있다. 모든 층에 대해서 전체적으로 테스트를 작성하게 되면, 테스트 내용의 중복이 발생하거나 테스트의 유지보수가 힘들어진다. 그러므로 프로젝트마다 어느 정도의 테스트를 어떤 층에 대해 작성 할 것인지 정책을 명확하게 결정해 둘 필요가 있다.

###### - 테스트하기 어려운 부분은 어떻게 할 것인가?

> '상태를 갖고 있는 처리' 나 '환경에 의존하는 처리' 는 테스트하기 어렵다.
>
> -	데이터베이스에 액세스하는 처리의 테스트
> -	다른 서비스의 API 에 액세스하는 테스트
> -	파일 시스템을 다루는 처리의 테스트
> -	메일 송수신하는 처리의 테스트
> -	스레드 등 병행 처리의 테스트
>
> 이러한 테스트들은 '상태'나 '환경'을 테스트가 기대하는 초기 상태로 셋업하고나서 시행하거나, 모의 객체(Mock) 등으로 에뮬레이트하는 수밖에 없다.

### 정리

*처음 테스트 코드를 작성할 때다. 모든 메소드들에 대해서 해야 하는 건가? 생각에 의해서 메소드는 항상 변경, 추가가 되는데 그에 따라 테스트 코드를 작성을 해야 하는건가? 라는 생각을 한 적이 있다.*

*A메소드에 대한 테스트를 작성하였는데 다음날 A메소드가 필요 없다고 판단되고 A-1메소드가 생기면 테스트 코드도 변경이 이루어 지게 된다. 이것이 반복되면 테스트 작성이 (선 테스트 작성 -> 후 코드 작성) 순서가 아니라 (선 코드 작성 -> 후 테스트 작성) 으로 변하게 된다. 이 상황이 현재 나의 상황인 것 같다.*

*다시 나의 상황을 돌아보면 API기준으로 컨트롤러단에 대한 테스트를 진행하고 [입력에 대한 결과 확인.. 이는 사실 프로젝트를 올리지 않고 바로바로 Junit 으로 올려가면서 API 를 개발할수 있는 편리함에 먼저 하는 듯 하다..] API 를 개발 완료한 후 추가적으로 필요한 테스트를 진행한다.. (도메인클래스, 유틸클래스, 헬퍼클래스 위주로..)*

*아직 테스트 작성이 습관이 되지는 않았다. 처음 개발을 시작할때에 낯설고 어려웠던 것 처럼 현재의 나는 테스트 작성을 할때 어떻게 작성을 해야 잘 작성을 하는 건지 고민하는 단계인것 같다. 이런 고민이 나중에 테스트를 막힘없이 작성하는 내가 되길 바란다..*

**'단위 테스트가 습관이 되면 테스트가 없는 코드는 불안해서 신뢰할 수 없게 된다'** *라고 이번장에서는 말한다. 하나의 프로젝트가 생각했던 것 보다 많이 유지되는 것을 많이 본다. 이는 내가 지금 작성한 코드가 굉장히 오래 살아 있고 누군가에 의해 유지보수가 된다는 것을 뜻한다. 나를 위한 테스트코드 작성이 아닌 다음 사람을 위한 테스트코드 작성으로 생각을 하면 테스트 커버리지를 더 높일 수 있지 않을까? 생각이 든다.*
