7장. 코드의 성능
----------------

### 성능을 의식하고 있는가?

-	시스템이 완성되어 릴리즈 해 봤더니, 쓸 만한 것이 못될 정도로 느리다.
-	장기간 사용으로 인해 데이터양이 증가해서 속도가 점점 느려졌다.
-	커다란 파일을 업로드했더니 한 방에 서버가 다운되어 버렸다.

> 위 문제들은 모두 성능을 의식하지 않거나 성능에 대한 고려 부족으로 인해 발생한 문제들이다. 그래서 이번에는 '효율 좋게 동작하는 코드' 를 실현하기 위한 방법에 대해 알아본다.

### 성능은 계산량으로 결정된다

> 코드에는 한 개의 명령마다 비용이 발생한다. 그 비용을 수치화해서 합계를 낸 것이 계산량이다. 계산량이 적다면 성능이 좋고, 계산량이 많다면 성능은 나쁘다.

###### - 알고리즘의 선택으로 변한다

> for 문 사용시 조건에 맞을경우 break, continue 로 종료 함으로써 계산량을 줄인다.

###### - 클래스의 선택에 따라 변한다

> -	ArrayList
>
> 	-	배열을 이용하여 리스트 관리 , 요소 삽입 삭제에 느리며 인덱스 참조는 고속이다.
>
> -	LinkedList
>
> 	-	참조리스트를 이용하여 리스트를 관리, 도중에 요소 삽입 삭제가 빠르며 인덱스 참조는 느리다.
>
> > *여러 자료구조에 대해 넓게 알 필요가 있겠다. 그리고 상황에 따라 적적하게 사용이 필요해 보인다.*

### 성능 개선의 순서

> 성능에 있어서 문제가 발생할 것 같은 부분이나 실제로 발생해 버린 경우에는 성능 튜닝을 실행한다. 이때 빠지기 쉬운 실수로는 다음과 같다.
>
> -	원인이 되는 부분을 특정하지 않고 마구 튜닝하기
> -	측정하지 않고 자신의 생각대로 성능을 판단하기

###### 1. 측정하기

> 예상이나 직감에 의한 판단은 위험하다. 우선은 처리에 걸린 시간을 기계적으로 그리고 객관적으로 측정하자.
>
> -	로그 출력에 의한 측정
>
> 	-	처리의 전후에 현재의 시각을 기록하여 걸린 시간을 로그로 출력하는 방법으로 원시적이긴 하지만, 간단하게 시도해 볼 수 있다. 대상 코드를 실행하기 위한 작은 단위 테스트를 준비하여 몇 번이고 테스트할 수 있는 상태로 만들어 두면 좀 더 효율적이다.
>
> -	프로파일러에 의한 측정
>
> 	-	프로파일러라 함은 실행 중인 프로그램의 처리 시간이나 실행 순서, 메모리 사용량 등을 감시하며 측정할 수 있는 툴을 말한다. 프로파일러에는 무료 및 유료를 포함해서 언어나 실행환경에 따라 여러 가지가 존재한다.
>

###### 2. 원인 특정하기

> 측정할 수 있는 상태가 되면, 조금씩 측정의 범위를 좁혀 나가 성능이 나빠지는 원인 부분을 특정하도록 한다.

###### 3. 튜닝하기

###### 4. 튜닝 결과 측정하기

> 튜닝이 끝나면, 다시 한 번 측정을 행하여 튜닝 전과 비교해 개선되었는지를 수치로 확인한다.

### 알고리즘 선택 이외의 성능 개선

###### - SQL이나 테이블 설계 변경하기

> 업무 시스템이나 웹 애플리케이션의 병목 현상은 효율이 나쁜 SQL 이 원인인 경우가 많다. 데이터가 많아지면 데이터양에 비례해서 처리가 늦어지는 트러블이 자주 발생하곤 한다.

###### - 캐시 사용하기

###### - 인프라 강화하기

-	서버의 메모리를 늘린다.
-	서버의 CPU 를 강화한다.
-	서버의 대수를 늘린다.
-	가상 머신을 버전 업한다.
-	사용하고 있는 라이브러리를 버전 업한다.
-	데이터베이스 서버의 데이터 영역을 고속 저장 장치로 변경한다.

### 성능 개선의 지침

> 성능 개선은 마구 행한다고 해서 좋아지는 것이 아니다!

###### - 어느 타이밍에 튜닝을 하는 것이 최선인가?

> 개발 초기 단계부터 성능을 의식해 둘 필요는 있지만, 너무 이른 튜닝은 YAGNI의 정신을 위배하는 부분도 있다. 다음과 같은 방침으로 진행한다면 좋은 밸런스를 유지할 수 있을 것이다.
>
> -	유지보수성을 해치지 않고 성능이 향상될 경우, 항상 성능이 좋은 방법을 채택한다.
> -	성능 저하가 시스템의 치명적인 문제가 되는 부분은 조기에 계획한다.

###### - 적절한 양의 테스트 데이터를 준비하자

> 개발 시부터 데이터의 증가량이나 액세스 수를 예상해서 실제 운용에 가까운 데이터양으로 테스트를 행하는 것은 매우 중요하다. 이것을 게을리 하면 서비스 개시에는 문제없이 잘 지나가도 1년 정도 경과하면 데이터가 증가하여 시스템이 쓸모없을 정도의 레벨로 성능이 악화되기도 한다.

###### - 항상 성능을 의식하자

> 코딩이나 테이블의 설계, 아키텍처의 선택 등 여러 가지 상황에서 항상 성능을 의식하자.

### 정리

> *성능은 항상 중요하게 생각하는 부분이다. 테이블의 설계.. 인덱스 설계.. 이외에도 캐시, 자료구조, 알고리즘 등을 사용하여 최선의 성능을 내도록 고민해 봐야 겠다.*

### YAGNI ( You aren't gonna need it )

[YAGNI 제타위키](https://zetawiki.com/wiki/YAGNI).

-	그건 필요하지 않을거다
-	당장 필요하지 않은 것은 미리 구현하지 말자
-	실제로 코드가 필요하기 전까지는 해당 코드를 작성하지 말자
-	"기능이 실제로 필요하기 전까지는 추가하지 않는 것이 좋다"라는 익스트림 프로그래밍 원칙
-	나중에 쓰일 것 같다는 예측에 따라 만든 것은 실제로는 10% 정도 밖에 쓰이지 않음
-	필요 이상의 기능을 추가하면 설계가 복잡해짐
-	인력을 한정적이므로 현실적 문제에 집중해야 함
-	코드를 빨리 구현하려면 코드를 적게 써라. 오류를 줄이려면 코드를 적게 써라.
